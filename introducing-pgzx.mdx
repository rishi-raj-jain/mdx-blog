---
title: 'Introducing pgzx: create PostgreSQL extensions using Zig'
description: 'We are excited to introduce pgzx, a framework for creating Postgres extensions using the Zig programming language.'
image:
  src: https://raw.githubusercontent.com/xataio/mdx-blog/main/images/introducing-pgroll.jpg
  alt: pgzx
author: Tudor Golubenco, Steffen Siering
authorEmail: tudor@xata.io
date: 3-21-2024
tags: ['open-source', 'postgres', 'fpPgzx']
published: true
slug: introducing-pgzx
ogImage: https://raw.githubusercontent.com/xataio/mdx-blog/main/images/introducing-pgroll.jpg
---

As part of the [Xata launch week](https://xata.io/launch-week-unleash-the-elephant), we are introducing [pgzx](https://github.com/xataio/pgzx), an open-source framework for developing PostgreSQL extensions written in Zig. It provides a set of utilities (e.g. error handling, memory allocators, wrappers) as well as a build and development environment that simplify integrating with the Postgres code base.

## Why Zig for Postgres extensions

[Zig](https://ziglang.org/) is described on its website as a general-purpose programming language and toolchain for maintaining robust, optimal and reusable software. Zig is a new language (pre 1.0), but it has been [gaining popularity](https://notes.eatonphil.com/2024-03-15-zig-rust-and-other-languages.html) in the systems programming community. It is fair to think of it as a "modern C", providing safe(r) memory management, compilation time code execution (comptime), and a rich standard library.

At Xata, we have been working on a new Postgres project, which doesn't really has a name yet, so let's call it "Xata's take at distributed Postgres". It is only in its very early stages, however we'll be open sourcing it soon and we're planning to build it in public. It will be somewhat similar to Citus, yet with some different choices, especially around usage and DX, based on what we learned running Xata for the past couple of years.

For this project, we considered two potential implementation directions:

1. as an external proxy, like Vitess does for MySQL
2. as a Postgres extension, like Citus
3. as a fork of Postgres, like Greenplum

We have some experience with the first option because that's how our current Xata Proxy works, see more details in this [blog post](), so we were almost biased towards it. We knew we can speak the Postgres wire protocol, parse the incoming queries and understand them to a fairly deep level, as well as create distributed transactions via 2PC. However, we also knew that if we were able to leverage existing Postgres code it will open up a lot more options. Given the long term vision of the project, we decided to go with the second option.

The next node in our decision tree was the programming language. The main options we considered were C, Rust, and Zig. C is the obvious choice because Postgres is written in C and so are most of its major extensions. It still is our fall-back option, but we wanted to see if we could try a newer language first.

Rust is becoming increasingly popular for writing Postgres extensions thanks to the [pgrx](https://github.com/pgcentralfoundation/pgrx) project. The fact that Rust is on its way to become a "trusted language", meaning that extensions written in it will be able to be loaded by cloud providers without the need to vet them is really exciting to us.\_createMdxContent

Our main concern was that `pgrx` would necessarily limit the APIs from Postgres that we could use, and we wanted to be able to. `pgrx` needs to to wrappers for each piece of functionality in Postgres. Another thing to consider also we felt that the key advantages of Rust are less relevant when working inside Postgres. Yurii Rashkovskii, the author of [Omnigres](https://github.com/omnigres/omnigres) seems to have gone through a [similar thought process](https://yrashk.medium.com/why-not-rust-for-omnigres-faa6fda7d1ec).

While we haven't picked

The main reason we considered Zig for this project is its ability to interoperate with C code. Zig supports the C ABI, can work with C pointers and data types, including NULL terminated strings, and can even translate C header files into Zig code. While the automatic translating of C macros to Zig is not perfect yet, it can still help a great deal. This makes Zig a great choice for working with very large C code bases, like Postgres happens to be.
